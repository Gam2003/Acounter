<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบนับเลข 96 ช่อง (บันทึกค่าได้)</title>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #fcfcfc;
            padding: 20px;
            margin: 0;
        }

        h1 {
            color: #d32f2f;
            margin-bottom: 20px;
        }

        /* ปุ่มควบคุมต่างๆ */
        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            width: 100%;
            max-width: 1300px;
            justify-content: space-between;
        }

        .total-display {
            font-size: 1.2rem;
            color: #333;
            font-weight: bold;
        }
        
        .total-display span {
            color: #d32f2f;
            font-size: 1.5rem;
        }

        .reset-btn {
            background-color: #ff5252;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s;
        }

        .reset-btn:hover {
            background-color: #d32f2f;
        }

        /* Container สำหรับตาราง */
        .grid-wrapper {
            max-width: 100%;
            overflow-x: auto;
            padding-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 8px;
            background: white;
            padding: 15px;
        }

        /* Grid 4 แถว x 24 คอลัมน์ */
        #counter-grid {
            display: grid;
            grid-template-columns: repeat(24, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 5px;
            min-width: 1300px;
        }

        /* ดีไซน์ของแต่ละช่อง */
        .counter-box {
            height: 60px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ffcccb;
            border-radius: 6px;
            cursor: pointer;
            background-color: #fff5f5;
            transition: all 0.1s ease;
            user-select: none;
            flex-direction: column;
        }

        .counter-box:hover {
            transform: translateY(-2px);
            border-color: #ff5252;
            box-shadow: 0 2px 4px rgba(255, 0, 0, 0.2);
            z-index: 10;
        }

        /* เลขกำกับช่อง (1-96) */
        .box-number {
            position: absolute;
            top: 2px;
            left: 5px;
            font-size: 10px;
            opacity: 0.6;
        }

        /* ตัวเลขนับจำนวน */
        .count-value {
            font-size: 18px;
            font-weight: bold;
        }

    </style>
</head>
<body>

    <h1>ระบบนับจำนวน 96 ช่อง (Auto Save)</h1>

    <div class="controls">
        <div class="total-display">
            ยอดรวมทั้งหมด: <span id="grand-total">0</span> ครั้ง
        </div>
        <button class="reset-btn" id="reset-btn">รีเซ็ตข้อมูลใหม่ (ล้างค่า)</button>
    </div>

    <div class="grid-wrapper">
        <div id="counter-grid">
            </div>
    </div>

    <script>
        const ROWS = 4;
        const COLS = 24;
        const TOTAL_BOXES = ROWS * COLS;
        const STORAGE_KEY = 'counter_96_data'; // ชื่อคีย์สำหรับบันทึกลงเครื่อง

        const gridContainer = document.getElementById('counter-grid');
        const grandTotalSpan = document.getElementById('grand-total');
        const resetBtn = document.getElementById('reset-btn');

        // โหลดข้อมูลเก่าจาก LocalStorage ถ้าไม่มีให้สร้าง Array 0 ใหม่
        let countsData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || new Array(TOTAL_BOXES).fill(0);
        let grandTotal = countsData.reduce((a, b) => a + b, 0); // คำนวณยอดรวมเริ่มต้น
        
        // อัปเดตยอดรวมเริ่มต้นบนหน้าจอ
        grandTotalSpan.innerText = grandTotal.toLocaleString();

        // ฟังก์ชันบันทึกข้อมูล
        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(countsData));
        }

        // ฟังก์ชันคำนวณสีแดง
        function getRedColor(count) {
            const baseHue = 0;
            const baseSat = 90;
            let lightness = 98 - (count * 5); 
            if (lightness < 40) lightness = 40;

            const textColor = lightness < 65 ? '#ffffff' : '#5a0000';
            const numOpacity = lightness < 65 ? 0.8 : 0.5;

            return {
                bg: `hsl(${baseHue}, ${baseSat}%, ${lightness}%)`,
                text: textColor,
                numOpacity: numOpacity,
                border: `hsl(${baseHue}, ${baseSat}%, ${lightness - 10}%)`
            };
        }

        // เก็บ References ของ Element กล่องไว้เพื่ออัปเดตภายหลัง
        const boxElements = [];

        // ลูปสร้างช่อง
        for (let i = 0; i < TOTAL_BOXES; i++) {
            const box = document.createElement('div');
            box.classList.add('counter-box');
            
            const boxID = i + 1;
            
            // สร้าง Element ภายใน
            const numberSpan = document.createElement('span');
            numberSpan.classList.add('box-number');
            numberSpan.innerText = boxID;

            const countSpan = document.createElement('span');
            countSpan.classList.add('count-value');
            
            box.appendChild(numberSpan);
            box.appendChild(countSpan);
            
            // เก็บ Element ไว้ใน Array เพื่อให้เรียกใช้ง่ายตอนรีเซ็ต
            boxElements.push({ box, countSpan, numberSpan });

            // ฟังก์ชันสำหรับอัปเดตหน้าตาของกล่องนี้ตามค่า count
            const updateBoxDisplay = (val) => {
                countSpan.innerText = val;
                const colors = getRedColor(val);
                box.style.backgroundColor = colors.bg;
                box.style.color = colors.text;
                box.style.borderColor = colors.border;
                numberSpan.style.opacity = colors.numOpacity;
            };

            // อัปเดตค่าเริ่มต้น (เผื่อโหลดมาแล้วมีค่า)
            updateBoxDisplay(countsData[i]);

            // Event เมื่อคลิก
            box.addEventListener('click', () => {
                countsData[i]++; // เพิ่มค่าใน data
                updateBoxDisplay(countsData[i]); // อัปเดตหน้าจอช่องนั้น
                
                grandTotal++; // เพิ่มยอดรวม
                grandTotalSpan.innerText = grandTotal.toLocaleString();
                
                saveData(); // บันทึกลงเครื่องทันที
            });

            gridContainer.appendChild(box);
        }

        // ฟังก์ชันปุ่มรีเซ็ต
        resetBtn.addEventListener('click', () => {
            if (confirm('คุณแน่ใจหรือไม่ว่าจะล้างค่าการนับทั้งหมด? ข้อมูลจะหายไปถาวร')) {
                // รีเซ็ตข้อมูล data
                countsData = new Array(TOTAL_BOXES).fill(0);
                grandTotal = 0;
                
                // อัปเดตหน้าจอทุกช่อง
                boxElements.forEach((el, index) => {
                    el.countSpan.innerText = 0;
                    // รีเซ็ตสีกลับเป็นค่าเริ่มต้น (count = 0)
                    const colors = getRedColor(0);
                    el.box.style.backgroundColor = colors.bg;
                    el.box.style.color = colors.text;
                    el.box.style.borderColor = colors.border;
                    el.numberSpan.style.opacity = colors.numOpacity;
                });

                // อัปเดตยอดรวม
                grandTotalSpan.innerText = "0";
                
                // บันทึกค่าว่างเปล่าลงเครื่อง
                saveData();
            }
        });

    </script>
</body>
</html>
